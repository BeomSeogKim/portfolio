# :pushpin: ìš°.ì´.ì‚­ (ìš°ë¦¬ ì´ê±° ì‚­ì œí•˜ì§€ ë§ì)
> ì»¤í”Œ ê¸°ë°˜ ë‹¤ì´ì–´ë¦¬ ì„œë¹„ìŠ¤  
> ğŸ”— [Service](https://woisac.netlify.app/)   
> ğŸ”— [Backend API](https://love-back.kro.kr/docs/index.html)

</br>

## 1. ì œì‘ ê¸°ê°„ & ì°¸ì—¬ ì¸ì›
- 2023ë…„ 10ì›” 12ì¼ ~ 2023ë…„ 12ì›” 04ì¼
- íŒ€ í”„ë¡œì íŠ¸
  - [FrontEnd] : ê¹€ì •í˜¸(íŒ€ì¥), í™ê±´ìš°, ì¡°ìˆ˜ì—°
  - [BackEnd]  : ê¹€ë²”ì„(íŒ€ì¥), ê¹€ë„ì—°, ê¹€ì¬ì›… 

</br>

## 2. ì‚¬ìš© ê¸°ìˆ 
#### `Backend`
  - Java 17, Spring Boot 3.1, MySQL 8.0, H2
  - Spring Data JPA, QueryDSL
  - Spring HATEOAS
  - Spring OAUTH2 Client, JWT
  - Spring REST Docs
  - Junit5, Mockito, ArchUnit, Ngrinder
  - Prometheus, Spring Actuator
  - flyway, caffeine

</br>

## 3. ERD ì„¤ê³„

<img src="https://github.com/BeomSeogKim/portfolio/assets/110332047/e0dc3e73-43fd-4f9d-9728-968a2f5377d1" alt="ëŒ€ì²´ í…ìŠ¤íŠ¸" width="1500" height="600">

   
## 4. í•µì‹¬ ê¸°ëŠ¥
ì´ ì„œë¹„ìŠ¤ì˜ í•µì‹¬ ê¸°ëŠ¥ì€ ë‹¤ì´ì–´ë¦¬ ê¸°ëŠ¥ì…ë‹ˆë‹¤.  
ë‹¤ì´ì–´ë¦¬ëŠ” ì¹´ì¹´ì˜¤ë§µ ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±ì„ í•©ë‹ˆë‹¤.  
ë‹¤ì´ì–´ë¦¬ ì¡°í¬ ê²½ìš° ì´ ë„¤ê°€ì§€ ì¡°íšŒ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.   
1. ì¹´ì¹´ì˜¤ ë§µì—ì„œ ë³´ì—¬ì§€ëŠ” ë‹¤ì´ì–´ë¦¬ ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ
2. íŠ¹ì • ì¥ì†Œ ë‹¤ì´ì–´ë¦¬ ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ
3. ì»¤í”Œì´ ì‘ì„±í•œ ë‹¤ì´ì–´ë¦¬ ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ
4. ë‹¤ì´ì–´ë¦¬ ìƒì„¸ ì¡°íšŒ

<details>
  <summary>ì§€ë„ ì˜ˆì‹œ</summary>

  ![image](https://github.com/BeomSeogKim/portfolio/assets/110332047/5057c922-e007-4569-bff7-ea509bac48b8)

</details>


<details>
  <summary>Infra</summary>

  ![image](https://github.com/Lovely-4K/love-backend/assets/110332047/cf61aaed-5b45-433b-bc0d-bcaf0a8c80ab)

</details>

<details>
  <summary>CI / CD</summary>

  ![image](https://github.com/Lovely-4K/love-backend/assets/110332047/14e62846-d571-4a63-b162-97f1d18de477)

</details>

</br>

## 5. ì„œë¹„ìŠ¤ ê°œì„  ì‚¬í•­
> ê° ê°œì„  ì‚¬í•­ì— ëŒ€í•´ í† ê¸€ì„ í´ë¦­í•˜ì‹œë©´ ìì„¸í•œ ë‚´ìš©ì„ í™•ì¸ í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  

<details>
  <summary> SQL íŠœë‹ </summary>

  </br>
  <details>
  <summary> ë‹¤ì´ì–´ë¦¬ ëª©ë¡ ì¡°íšŒ ì¿¼ë¦¬ ê°œì„  </summary>

  ë‹¤ì´ì–´ë¦¬ ëª©ë¡ ì¡°íšŒì˜ ê²½ìš° ë°ì´íŠ¸ ë‚ ì§œ ê¸°ì¤€ìœ¼ë¡œ ìµœê·¼ìˆœìœ¼ë¡œ ì¡°íšŒí•˜ëŠ” ì¿¼ë¦¬ë¥¼ ì œì¼ ë§ì´ ì‚¬ìš©í•©ë‹ˆë‹¤.  
  í•´ë‹¹ ì¿¼ë¦¬ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. 
  ```sql
  SELECT d.id, l.kakao_map_id, d.first_image, d.dating_day, l.place_name,
         l.address, l.latitude, l.longitude
  FROM diary d
           LEFT JOIN location l ON l.id = d.location_id
  WHERE d.couple_id = 1
  ORDER BY d.dating_day DESC
  LIMIT 20 OFFSET 0;
  ```
  íŠœë‹ ì „ì˜ ì‹¤í–‰ ê³„íšê³¼ ë¶„ì„ ê²°ê³¼ëŠ” ë‹¤ìŒê³¼ ê°™ì•˜ìŠµë‹ˆë‹¤.
  <details>
  <summary>ê¸°ì¡´</summary>
  
  ```sql
  -> Limit: 20 row(s)  (cost=6196 rows=20) (actual time=10.7..10.8 rows=20 loops=1)
      -> Nested loop left join  (cost=6196 rows=12110) (actual time=10.7..10.8 rows=20 loops=1)
          -> Sort: d.dating_day DESC, limit input to 20 row(s) per chunk  (cost=1957 rows=12110) (actual time=10.7..10.7 rows=20 loops=1)
      -> Index lookup on d using idx_diary_couple_id (couple_id=1)  (cost=1957 rows=12110) (actual time=0.2..9.67 rows=6729 loops=1)
      -> Single-row index lookup on l using PRIMARY (id=d.location_id)  (cost=0.25 rows=1) (actual time=0.00262..0.00265 rows=1 loops=20)
  ```

  | id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | filtered | Extra |
  | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
  | 1 | SIMPLE | d | null | ref | idx_diary_couple_id | idx_diary_couple_id | 9 | const | 12110 | 100 | Using filesort |
  | 1 | SIMPLE | l | null | eq_ref | PRIMARY | PRIMARY | 8 | love.d.location_id | 1 | 100 | null |
  </details>
  
  Using filesortì˜ ê²½ìš° rowê°€ ë§ì•„ì§ˆ ìˆ˜ë¡ ì„±ëŠ¥ì´ ë–¨ì–´ì§„ë‹¤ëŠ” ë‹¨ì ì´ ì¡´ì¬í•©ë‹ˆë‹¤. ë”°ë¼ì„œ Covering Indexë¥¼ ì ìš©í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.   
  
  `CREATE INDEX  idx_couple_id_dating_day ON diary(dating_day, couple_id);`

  <details>
    <summary>1ì°¨ ì„±ëŠ¥ íŠœë‹</summary>

    ```sql
    -> Limit: 20 row(s)  (cost=3031 rows=19.9) (actual time=0.21..6.54 rows=20 loops=1)
    -> Nested loop left join  (cost=3031 rows=19.9) (actual time=0.209..6.54 rows=20 loops=1)
        -> Filter: (d.couple_id = 1)  (cost=1.23 rows=19.9) (actual time=0.198..6.48 rows=20 loops=1)
            -> Index scan on d using idx_couple_id_dating_day (reverse)  (cost=1.23 rows=157) (actual time=0.19..6.33 rows=2405 loops=1)
        -> Single-row index lookup on l using PRIMARY (id=d.location_id)  (cost=0.25 rows=1) (actual time=0.00282..0.00286 rows=1 loops=20)
    ```

  | id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | filtered | Extra |
  | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
  | 1 | SIMPLE | d | null | index | idx_diary_couple_id | idx_couple_id_dating_day | 13 | null | 157 | 12.68 | Using where; Backward index scan |
  | 1 | SIMPLE | l | null | eq_ref | PRIMARY | PRIMARY | 8 | love.d.location_id | 1 | 100 | null |
  </details>

  ì¡°íšŒë¡œì§ì˜ ê²½ìš° ë³´í†µ ìµœê·¼ìˆœìœ¼ë¡œ ì¡°íšŒí•˜ê¸° ë•Œë¬¸ì— Using Backward index scanì´ ê±¸ë¦¬ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.  
  ì´ì— ë”°ë¼ ë°ì´íŠ¸ ë‚ ì§œ ì •ë ¬ ì¡°ê±´ì„ ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ ë³€ê²½í›„ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•´ ì£¼ì—ˆìŠµë‹ˆë‹¤.   
  
  `CREATE INDEX  idx_couple_id_dating_day ON diary(dating_day DESC , couple_id);`

  <details>
    <summary>2ì°¨ ì„±ëŠ¥ íŠœë‹</summary>

    ```sql
    -> Limit: 20 row(s)  (cost=3031 rows=19.9) (actual time=0.214..0.43 rows=20 loops=1)
    -> Nested loop left join  (cost=3031 rows=19.9) (actual time=0.213..0.428 rows=20 loops=1)
        -> Filter: (d.couple_id = 1)  (cost=1.23 rows=19.9) (actual time=0.202..0.376 rows=20 loops=1)
            -> Index scan on d using idx_couple_id_dating_day  (cost=1.23 rows=157) (actual time=0.199..0.362 rows=188 loops=1)
        -> Single-row index lookup on l using PRIMARY (id=d.location_id)  (cost=0.25 rows=1) (actual time=0.00231..0.00235 rows=1 loops=20)
    ```

  | id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | filtered | Extra |
  | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
  | 1 | SIMPLE | d | null | index | idx_diary_couple_id | idx_couple_id_dating_day | 13 | null | 157 | 12.68 | Using where |
  | 1 | SIMPLE | l | null | eq_ref | PRIMARY | PRIMARY | 8 | love.d.location_id | 1 | 100 | null |
  </details>

  ê¸°ì¡´ ì¿¼ë¦¬ì™€ íŠœë‹ í›„ ì„±ëŠ¥ ê°œì„ ì‚¬í•­ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. 
  | ì„±ëŠ¥ ì§€í‘œ | íŠœë‹ ì „ | íŠœë‹ í›„ | ì„±ëŠ¥ ê°œì„  (%) |
  | --- | --- | --- | --- |
  |ì´ ìˆ˜í–‰ì‹œê°„ (ms) | 10.8 | 0.43 | 96.02 |
  | ì²˜ë¦¬ í–‰ ìˆ˜ | 12,110 | 19.9 | 99.84 |
  </details>

  </br>
  
  <details>
  <summary>ë‹¤ì´ì–´ë¦¬ ë§ˆì»¤ ì¡°íšŒ ì¿¼ë¦¬ ê°œì„ </summary>
  ë‹¤ì´ì–´ë¦¬ ë§ˆì»¤ ì¡°íšŒë€ ë™ì¼í•œ ì¥ì†Œì— í•´ë‹¹í•˜ëŠ” ë‹¤ì´ì–´ë¦¬ ëª©ë¡ë“¤ì„ ì¡°íšŒí•  ë•Œ ì‚¬ìš©í•˜ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤.

  í•´ë‹¹ ì¿¼ë¦¬ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. 
  ```sql
  SELECT d1_0.id, d1_0.boy_text, d1_0.couple_id, d1_0.created_at, d1_0.dating_day,
         d1_0.girl_text, l1_0.id, l1_0.address, l1_0.category, l1_0.created_at,
         l1_0.kakao_map_id, l1_0.latitude, l1_0.longitude, l1_0.updated_at, l1_0.place_name,
         d1_0.updated_at, d1_0.fifth_image, d1_0.first_image, d1_0.fourth_image, d1_0.second_image,
         d1_0.third_image, d1_0.score
  FROM diary d1_0
           JOIN location l1_0 ON l1_0.id = d1_0.location_id
  WHERE l1_0.kakao_map_id = 10978
    AND d1_0.couple_id = 1;
  ```

  íŠœë‹ ì „ì˜ ì‹¤í–‰ ê³„íšê³¼ ë¶„ì„ ê²°ê³¼ëŠ” ë‹¤ìŒê³¼ ê°™ì•˜ìŠµë‹ˆë‹¤.
  
  <details>
    <summary>ê¸°ì¡´</summary>
    
    ```sql
    -> Nested loop inner join  (cost=6192 rows=605) (actual time=28.4..28.6 rows=23 loops=1)
        -> Filter: (d1_0.location_id is not null)  (cost=1956 rows=12102) (actual time=0.0299..14.3 rows=6725 loops=1)
            -> Index lookup on d1_0 using idx_diary_couple_id (couple_id=1)  (cost=1956 rows=12102) (actual time=0.0284..13.7 rows=6725 loops=1)
        -> Filter: (l1_0.kakao_map_id = 10978)  (cost=0.25 rows=0.05) (actual time=0.00199..0.00199 rows=0.00342 loops=6725)
            -> Single-row index lookup on l1_0 using PRIMARY (id=d1_0.location_id)  (cost=0.25 rows=1) (actual time=0.00175..0.00178 rows=1 loops=6725)
    ```
  
  | id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | filtered | Extra |
  | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
  | 1 | SIMPLE | d1_0 | null | ref | idx_diary_couple_id | idx_diary_couple_id | 9 | const | 12102 | 100 | Using where |
  | 1 | SIMPLE | l1_0 | null | eq_ref | PRIMARY,idx_lacation_kakao_map_id | PRIMARY | 8 | love.d1_0.location_id | 1 | 5 | Using where |
  </details>

  diary íŠ¹ì„± ì¤‘ location_idì™€ couple_idê°€ ìì£¼ ì‚¬ìš©ë˜ëŠ” ê²ƒì„ í™•ì¸í•˜ì—¬ ë‹¤ìŒê³¼ ê°™ì´ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•´ ì£¼ì—ˆìŠµë‹ˆë‹¤. 

  `CREATE INDEX idx_location_couple ON diary(location_id, couple_id);`

  <details>
    <summary>ì„±ëŠ¥ íŠœë‹ í›„</summary>
  
    ```sql
    -> Nested loop inner join  (cost=28 rows=40) (actual time=0.884..0.996 rows=23 loops=1)
      -> Index lookup on l1_0 using idx_lacation_kakao_map_id (kakao_map_id=10978)  (cost=14 rows=40) (actual time=0.145..0.159 rows=40 loops=1)
      -> Index lookup on d1_0 using idx_location_couple (location_id=l1_0.id, couple_id=1)  (cost=0.253 rows=1) (actual time=0.0203..0.0207 rows=0.575 loops=40)
    ```
  
  | id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | filtered | Extra |
  | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
  | 1 | SIMPLE | l1_0 | null | ref | PRIMARY,idx_lacation_kakao_map_id | idx_lacation_kakao_map_id | 9 | const | 40 | 100 | null |
  | 1 | SIMPLE | d1_0 | null | ref | idx_diary_couple_id,idx_location_couple | idx_location_couple | 18 | love.l1_0.id,const | 1 | 100 | null |
  </details>

  ê¸°ì¡´ ì¿¼ë¦¬ì™€ ì„±ëŠ¥ íŠœë‹ í›„ ì„±ëŠ¥ ê°œì„ ì‚¬í•­ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. 
  | ì„±ëŠ¥ ì§€í‘œ | íŠœë‹ ì „ | íŠœë‹ í›„ | ì„±ëŠ¥ ê°œì„  (%) |
  | --- | --- | --- | --- |
  |ì´ ìˆ˜í–‰ì‹œê°„ (ms) | 28.6 | 0.996 | 96.52 |
  | ì²˜ë¦¬ í–‰ ìˆ˜ | 12,102 | 40 | 99.67 |
</details>

</br>

<details>
  <summary>ë‹¤ì´ì–´ë¦¬ ì§€ë„ ì¡°íšŒ ì¿¼ë¦¬ ê°œì„ </summary>

  ë‹¤ì´ì–´ë¦¬ ì§€ë„ ì¡°íšŒì˜ ê²½ìš° uiì—ì„œ ë³´ì´ëŠ” ì§€ë„ ì•ˆì— ì¡´ì¬í•˜ëŠ” ë‹¤ì´ì–´ë¦¬ ëª©ë¡ì„ ì¡°íšŒí•˜ëŠ” ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
  í•´ë‹¹ ì¿¼ë¦¬ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

  ```sql
  SELECT d.id, d.boy_text, d.couple_id, d.created_at, d.dating_day,
       d.girl_text, l.id, l.address, l.category, l.created_at,
       l.kakao_map_id, l.latitude, l.longitude, l.updated_at, l.place_name,
       d.updated_at, d.fifth_image, d.first_image, d.fourth_image, d.second_image,
       d.third_image, d.score
  FROM diary d
         JOIN location l ON l.id = d.location_id
  WHERE d.couple_id = 1
    AND 90.0 <= l.latitude <= 91.0
    AND 90.0 <= l.longitude <= 91.0;
  ```

íŠœë‹ ì „ì˜ ì‹¤í–‰ ê³„íšê³¼ ë¶„ì„ ê²°ê³¼ëŠ” ë‹¤ìŒê³¼ ê°™ì•˜ìŠµë‹ˆë‹¤.

<details>
  <summary>ê¸°ì¡´</summary>
  
  ```sql
  -> Nested loop inner join  (cost=6192 rows=12102) (actual time=0.0396..32.6 rows=6725 loops=1)
    -> Filter: (d.location_id is not null)  (cost=1956 rows=12102) (actual time=0.0261..15.5 rows=6725 loops=1)
        -> Index lookup on d using idx_diary_couple_id (couple_id=1)  (cost=1956 rows=12102) (actual time=0.025..14.9 rows=6725 loops=1)
    -> Filter: (((90.0000000 <= l.latitude) <= 91.0) and ((90.0000000 <= l.longitude) <= 91.0))  (cost=0.25 rows=1) (actual time=0.00224..0.00235 rows=1 loops=6725)
        -> Single-row index lookup on l using PRIMARY (id=d.location_id)  (cost=0.25 rows=1) (actual time=0.00184..0.00187 rows=1 loops=6725)
  ```

| id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | filtered | Extra |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | SIMPLE | d | null | ref | idx_diary_couple_id,idx_location_couple | idx_diary_couple_id | 9 | const | 12102 | 100 | Using where |
| 1 | SIMPLE | l | null | eq_ref | PRIMARY | PRIMARY | 8 | love.d.location_id | 1 | 100 | Using where |
</details>

íŠ¹ì • ë²”ìœ„ì— ìˆëŠ” ê²°ê³¼ê°’ì„ ì°¾ì„ ë•Œ íš¨ê³¼ì ì´ì§€ ëª»í•œ ì¿¼ë¦¬ë¡œ ì¡°íšŒí•˜ëŠ” ê²ƒì„ í™•ì¸í–ˆìœ¼ë©° 1ì°¨ì ìœ¼ë¡œ ì¿¼ë¦¬ ë³€ê²½ì„ ì§„í–‰í–ˆìŠµë‹ˆë‹¤.  

ê´€ë ¨ ì¿¼ë¦¬ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.  

```sql
SELECT d.id, d.boy_text, d.couple_id, d.created_at, d.dating_day,
       d.girl_text, l.id, l.address, l.category, l.created_at,
       l.kakao_map_id, l.latitude, l.longitude, l.updated_at, l.place_name,
       d.updated_at, d.fifth_image, d.first_image, d.fourth_image, d.second_image,
       d.third_image, d.score
FROM diary d
         JOIN location l ON l.id = d.location_id
WHERE d.couple_id = 1
  AND l.latitude BETWEEN 90.0 AND 91.0
  AND l.longitude BETWEEN 100.0 AND 101.0;
```

ì¿¼ë¦¬ ë³€ê²½í›„ ê²°ê³¼ëŠ” ë‹¤ìŒê³¼ ê°™ì•˜ìŠµë‹ˆë‹¤. 

<details>
  <summary>1ì°¨ ì„±ëŠ¥ íŠœë‹</summary>

  ```sql
  -> Nested loop inner join  (cost=6192 rows=605) (actual time=28.9..29 rows=24 loops=1)
    -> Filter: (d.location_id is not null)  (cost=1956 rows=12102) (actual time=0.0278..14.3 rows=6725 loops=1)
        -> Index lookup on d using idx_diary_couple_id (couple_id=1)  (cost=1956 rows=12102) (actual time=0.0267..13.7 rows=6725 loops=1)
    -> Filter: ((l.latitude between 90.0 and 91.0) and (l.longitude between 100.0 and 101.0))  (cost=0.25 rows=0.05) (actual time=0.00207..0.00207 rows=0.00357 loops=6725)
        -> Single-row index lookup on l using PRIMARY (id=d.location_id)  (cost=0.25 rows=1) (actual time=0.00173..0.00177 rows=1 loops=6725)
  ```

| id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | filtered | Extra |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | SIMPLE | d | null | ref | idx_diary_couple_id,idx_location_couple | idx_diary_couple_id | 9 | const | 12102 | 100 | Using where |
| 1 | SIMPLE | l | null | eq_ref | PRIMARY | PRIMARY | 8 | love.d.location_id | 1 | 5 | Using where |
</details>

locationì˜ latitude, longitude ì˜ì—­ì— ëŒ€í•´ì„œ ì¸ë±ìŠ¤ê°€ ì—†ê¸° ë•Œë¬¸ì— Using where ì¡°ê±´ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. 

í•´ë‹¹ ë¶€ë¶„ì„ í•´ê²°í•˜ê¸° ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì´ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•´ ì£¼ì—ˆìŠµë‹ˆë‹¤. 

`CREATE INDEX*  idx_location_latitude_longitude *ON* location(latitude, longitude);`

<details>
  <summary>2ì°¨ ì„±ëŠ¥ íŠœë‹</summary>

  ```sql
  -> Nested loop inner join  (cost=23.9 rows=41) (actual time=0.0687..0.369 rows=24 loops=1)
    -> Index range scan on l using idx_location_latitude_longitude  (cost=18.7 rows=41) (actual time=0.0423..0.185 rows=41 loops=1)
        - Over: 90.0000000 <= latitude <= 91.0000000 AND 100.0000000 <= longitude <= 101.0000000
        - With index condition: ((l.latitude between 90.0 and 91.0) and (l.longitude between 100.0 and 101.0))
    -> Index lookup on d using idx_location_couple (location_id=l.id, couple_id=1)  (cost=0.272 rows=1) (actual time=0.00376..0.00424 rows=0.585 loops=41)
  ```

| id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | filtered | Extra |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | SIMPLE | l | null | range | PRIMARY,idx_location_latitude_longitude | idx_location_latitude_longitude | 14 | null | 41 | 11.11 | Using index condition |
| 1 | SIMPLE | d | null | ref | idx_diary_couple_id,idx_location_couple | idx_location_couple | 18 | http://love.l.id/,const | 1 | 100 | null |
</details>

ê¸°ì¡´ ì¿¼ë¦¬ì™€ ì„±ëŠ¥ íŠœë‹ í›„ ì„±ëŠ¥ ê°œì„ ì‚¬í•­ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. 
| ì„±ëŠ¥ ì§€í‘œ | íŠœë‹ ì „ | íŠœë‹ í›„ | ì„±ëŠ¥ ê°œì„  (%) |
| --- | --- | --- | --- |
|ì´ ìˆ˜í–‰ì‹œê°„ (ms) | 32.6 | 0.369 | 98.87 |
| ì²˜ë¦¬ í–‰ ìˆ˜ | 6725 | 24 | 99.64 |

</details>
</br>
</details>


<details> 
  <summary> ì–´í”Œë¦¬ì¼€ì´ì…˜ íŠœë‹ </summary>
  
  > ***ê° íŠœë‹ ë³„ ì„±ëŠ¥ ìˆ˜ì¹˜ëŠ” í† ê¸€ì„ í†µí•´ í™•ì¸ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.***
  
  ì»¤í”Œ ê¸°ë°˜ ë¹„ìŠ·í•œ ì„œë¹„ìŠ¤ë¥¼ ë¶„ì„í•´ë³¸ ê²°ê³¼ í•œë‹¬ì— 300ë§Œ íŠ¸ë˜í”½ì„ ì²˜ë¦¬í•˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤.  
  ë”°ë¼ì„œ ì €í¬ ì„œë¹„ìŠ¤ ë˜í•œ í•´ë‹¹ íŠ¸ë˜í”½ì„ ëª©í‘œë¡œ ì„±ëŠ¥ íŠœë‹ì„ ì§„í–‰í–ˆìŠµë‹ˆë‹¤.  
  ì–´í”Œë¦¬ì¼€ì´ì…˜ ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •í–ˆìŠµë‹ˆë‹¤.   
  `ë¡œê·¸ì¸ â†’ í”„ë¡œí•„ ì¡°íšŒ â†’ í”„ë¡œí•„ ìˆ˜ì • â†’ ë‹¤ì´ì–´ë¦¬ ì¡°íšŒ â†’ ë‹¤ì´ì–´ë¦¬ ì¡°íšŒ â†’ ë‹¤ì´ì–´ë¦¬ ì¡°íšŒ â†’ ë‹¤ì´ì–´ë¦¬ ì¡°íšŒ â†’ ë‹¤ì´ì–´ë¦¬ ì‘ì„± â†’ ì¼ì • ì¡°íšŒ â†’ ì¼ì • ì¡°íšŒ â†’ ì¼ì • ìƒì„± â†’ ì˜¤ëŠ˜ì˜ ì§ˆë¬¸ ì¡°íšŒ`  
  í‰ì†Œì—ëŠ” ì´ˆë‹¹ 9ëª…ì˜ ìœ ì €ê°€ ì‚¬ìš©í•œë‹¤ê³  ê°€ì •í–ˆìœ¼ë©°, ë¶ë¹„ëŠ” ì‹œê°„ì—ëŠ” í‰ì†Œ ì‹œê°„ëŒ€ë³´ë‹¤ 3ë°°ì˜ ìœ ì €ì¸ 27ëª…ì˜ ìœ ì €ê°€ ì‚¬ìš©í•œë‹¤ê³  ê°€ì •í–ˆìŠµë‹ˆë‹¤.

  
  

<details> 
  <summary>ê¸°ë³¸ ì„¤ì •</summary>
  
  ê¸°ë³¸ ì„¤ì •ì˜ ê²½ìš°  TPS ë° ì—ëŸ¬ìœ¨ì€ ë‹¤ìŒê³¼ ê°™ì•˜ìŠµë‹ˆë‹¤.   
  - Vuser9 : TPS 13.5  |  ì—ëŸ¬ìœ¨ : 0.1%
  ![image](https://github.com/BeomSeogKim/portfolio/assets/110332047/bb37fa38-b3c8-4e21-be3b-f2eee7d96bff)

  - Vuser27 : TPS 12.8  |  ì—ëŸ¬ìœ¨ :  4.4%
  ![image](https://github.com/BeomSeogKim/portfolio/assets/110332047/e95e2b60-d48b-40c6-9d0a-ad6e10c7a7f9)

</details>

Vuser 27ì˜ ê²½ìš° ì—ëŸ¬ìœ¨ì´ ê¸‰ê²©í•˜ê²Œ ë†’ì•„ì ¸ ëª¨ë‹ˆí„°ë§ í•´ë³¸ ê²°ê³¼ Connectionì„ ë°›ì§€ ëª»í•˜ê³  ê¸°ë‹¤ë¦¬ëŠ” ìƒí™©ì´ ë°œìƒí•´ Connection Timeout ë¬¸ì œê°€ ë°œìƒí•´ ì—ëŸ¬ìœ¨ì´ ê¸‰ê²©í•˜ê²Œ ì¦ê°€í•˜ëŠ” ê²ƒì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.  
ì´ì— ë”°ë¼ application.yamlíŒŒì¼ì—ì„œ hikari ê´€ë ¨ ì„¤ì •ì„ ë³€ê²½ì„ í–ˆìŠµë‹ˆë‹¤. 
```yaml
spring:
  datasource:
    hikari:
      minimum-idle: 10
      maximum-pool-size: 50
```

<details> 
  <summary>Connection Pool ìˆ˜ì • í›„</summary>
  
  Hikari Connection Pool ìˆ˜ì • í›„ TPS ë° ì—ëŸ¬ìœ¨ì€ ë‹¤ìŒê³¼ ê°™ì•˜ìŠµë‹ˆë‹¤.   
  - Vuser9 : TPS 12.0  |  ì—ëŸ¬ìœ¨ : 0.1%
  ![image](https://github.com/BeomSeogKim/portfolio/assets/110332047/f72dd2da-abdb-491a-bbe0-378bc34b359d)


  - Vuser27 : TPS 12.4  |  ì—ëŸ¬ìœ¨ :  0.1%
  ![image](https://github.com/BeomSeogKim/portfolio/assets/110332047/0d281f12-0c54-4316-a93d-222e99d1f98f)

</details>

Hikari Connection Pool ì„¤ì • ë³€ê²½ í›„ ì—ëŸ¬ìœ¨ì€ ê°ì†Œí–ˆì§€ë§Œ TPS ìì²´ëŠ” í¬ê²Œ ë³€ê²½ë˜ì§€ ì•ŠëŠ” ê²ƒì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.  
ë³´ë‹¤ ë†’ì€ TPSë¥¼ ìœ„í•´ ì¡°íšŒ ë¡œì§ì˜ ê²½ìš° ìºì‹œë¥¼ ì ìš©í•˜ê¸°ë¡œ ê²°ì •í–ˆìŠµë‹ˆë‹¤. Caffeine Cachceë¥¼ ì ìš©í–ˆìŠµë‹ˆë‹¤.

<details> 
  <summary>Cache ì ìš© í›„</summary>
  
  Spring Cache ì ìš© í›„ TPS ë° ì—ëŸ¬ìœ¨ì€ ë‹¤ìŒê³¼ ê°™ì•˜ìŠµë‹ˆë‹¤.   
  - Vuser9 : TPS 133.9  |  ì—ëŸ¬ìœ¨ : 0.0%
  ![image](https://github.com/BeomSeogKim/portfolio/assets/110332047/a8fadfed-45fc-4c94-aaa5-2032f0a44107)

  - Vuser27 : TPS 156.7  |  ì—ëŸ¬ìœ¨ :  0.0%
 ![image](https://github.com/BeomSeogKim/portfolio/assets/110332047/a7ce9ef1-f0fe-432c-8844-36a745112320)

  íŠ¹íˆ ìºì‹œê°€ ë³€ê²½ë˜ì§€ ì•ŠëŠ” ì¡°íšŒ ë¡œì§ë§Œ í…ŒìŠ¤íŠ¸ í•´ë³¸ ê²°ê³¼ëŠ” ë‹¤ìŒê³¼ ê°™ì•˜ìŠµë‹ˆë‹¤.
  
  - Vuser27 : TPS 368.8  |  ì—ëŸ¬ìœ¨ :  0.0%
  ![image](https://github.com/BeomSeogKim/portfolio/assets/110332047/9e3ec010-ea9d-45c7-b75a-9324e8d789db)

</details>
</br>
</details> 

<details> 
  <summary>CQRS íŒ¨í„´ ì ìš©</summary>

  Front ê°œë°œì ë¶„ë“¤ê³¼ í˜‘ì—…ì„ í•˜ë©° ì¡°íšŒ ê´€ë ¨í•œ ì¿¼ë¦¬ ë¡œì§ë“¤ì´ ë¹ˆë²ˆí•˜ê²Œ ë³€ê²½ì´ ë˜ëŠ” ë°˜ë©´ Command ê´€ë ¨í•œ ë¡œì§ì€ ë³€ê²½ì´ ë˜ì§€ ì•ŠëŠ” ê²ƒì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.  
  ì´ì— ë”°ë¼ Command ì™€ Query Serviceë¥¼ ë³€ê²½í•˜ì—¬ ë³´ë‹¤ ë³€ê²½ì„ í¸ë¦¬í•˜ê²Œ í•  ìˆ˜ ìˆë„ë¡ CQRS íŒ¨í„´ì„ ì ìš©í–ˆìŠµë‹ˆë‹¤. 

  - [Diary Command Service](https://github.com/Lovely-4K/love-backend/blob/dev/api/src/main/java/com/lovely4k/backend/diary/service/DiaryService.java#L32-L160)
  - [Diary Query Service](https://github.com/Lovely-4K/love-backend/blob/dev/api/src/main/java/com/lovely4k/backend/diary/service/DiaryQueryService.java#L16-L47)
  
</details> 



## 5. í•µì‹¬ íŠ¸ëŸ¬ë¸” ìŠˆíŒ…

<details>
  <summary> Spring Sessionì—ì„œ JWT ë³€í™˜ </summary>
  
  - ê¸°ì¡´ ìƒí™© 
    - ì†Œì…œ ë¡œê·¸ì¸ ì„±ê³µ ì‹œ WASì˜ end-point("/")ë¡œ redirect 
    - ì†Œì…œ ë¡œê·¸ì¸ ì„±ê³µ í›„ Session ë°©ì‹ìœ¼ë¡œ ë¡œê·¸ì¸ ê´€ë¦¬
  - ë¬¸ì œ ë°œìƒ
    - (ì •ì±… ë³€ê²½) ì†Œì…œ ë¡œê·¸ì¸ ì„±ê³µ í›„ Front Serverë¡œ redirect
    - ê¸°ì¡´ì— ì‚¬ìš©í•˜ë˜ Session ë°©ì‹ ì‚¬ìš© ì‹œ Backend Serverë¡œ Session ê°’ì„ ë³´ë‚´ì§€ ëª»í•˜ëŠ” í˜„ìƒ ë°œìƒ
  - ë¬¸ì œ ì›ì¸
    - Cookieì˜ `SameSite=Lax` ì„¤ì •ì´ ì›ì¸
    - `SameSite=Lax`ì˜ ê²½ìš° ë‹¤ë¥¸ ë„ë©”ì¸ê°„ ì¿ í‚¤ê°€ ì „ë‹¬ë˜ì§€ ì•ŠìŒ
  - ë¬¸ì œ í•´ê²°
    - `SameSite=None` ì„¤ì •ì˜ ê²½ìš° ë‹¤ë¥¸ ë„ë©”ì¸ê°„ ì „ë‹¬ì´ ê°€ëŠ¥í•˜ë‚˜ https í†µì‹ ì´ í•„ìš”í•¨
    - front íŒ€ì›ë“¤ì´ ì£¼ë¡œ í…ŒìŠ¤íŠ¸ í•˜ëŠ” í™˜ê²½ì€ http
    - JWTì˜ ê²½ìš° ë‹¤ë¥¸ ë„ë©”ì¸ê°„ì— ì „ë‹¬ì´ ê°€ëŠ¥í•˜ë©° ë³„ë„ë¡œ https í™˜ê²½ì´ ë”°ë¡œ í•„ìš”í•˜ì§€ ì•Šì•˜ìŒ
    - ì†Œì…œ ë¡œê·¸ì¸ ì„±ê³µì‹œ urlì— access token ê°’ì„ ê°™ì´ ë³´ë‚´ì£¼ëŠ” ê²ƒìœ¼ë¡œ ë¬¸ì œë¥¼ í•´ê²°í•¨
</details>

<details>
  <summary> Rest Docs ë¬¸ì„œê°€ ìƒì„±ë˜ì§€ ì•ŠëŠ” í˜„ìƒ </summary>

  
  - ë¬¸ì œ ë°œìƒ
    - EC2ì— ë„ìš´ jarì˜ ê²½ìš°, asciidoctorë¡œ ìƒì„±í•œ ë¬¸ì„œì— ì ‘ê·¼ì„ í•  ìˆ˜ ì—†ëŠ” í˜„ìƒ ë°œìƒ
    - í•´ë‹¹ jar íŒŒì¼ì„ ì••ì¶• í•´ì¬í•´ë³¸ ê²°ê³¼ ìƒì„±í•œ ë¬¸ì„œ íŒŒì¼ì´ ì¡´ì¬ í•˜ì§€ ì•ŠìŒì„ í™•ì¸
  - ë¬¸ì œ ì›ì¸
    - gradle build ê³¼ì •ì—ì„œ ë¬¸ì„œê°€ ìƒì„±ë˜ê¸° ì „ì— jarë¥¼ ë§Œë“¤ì–´ jar íŒŒì¼ ë‚´ì— asciidoctor ë¬¸ì„œê°€ ìƒì„±ë˜ì§€ ì•ŠìŒ
  - ë¬¸ì œ í•´ê²°
    - bootJar ë‚´ì— `dependsOn` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ ë¬¸ì„œ ìƒì„±ì´ ë¨¼ì € ë  ìˆ˜ ìˆë„ë¡ ë¹Œë“œ ê³¼ì • ìˆœì„œë¥¼ ë³€ê²½í•´ ë¬¸ì œ í•´ê²°

  [ ê´€ë ¨ ë§í¬ ](https://tommykim.tistory.com/79)
</details>
  
</br>

## 6. ê·¸ ì™¸ íŠ¸ëŸ¬ë¸” ìŠˆíŒ…

<details>
  <summary> Github Actions í…ŒìŠ¤íŠ¸ì—ì„œ Credential ì„¤ì • ê´€ë ¨ í…ŒìŠ¤íŠ¸ ê¹¨ì§ í˜„ìƒ </summary>

  - ë¬¸ì œ ë°œìƒ
    - í”„ë¡œì íŠ¸ì—ì„œ ë¹„ë°€ ê°’ë“¤ì€ githubì— ì˜¬ë¦¬ ì§€ ì•Šê³  ë³„ë„ì˜ íŒŒì¼ë¡œ ê´€ë¦¬í–ˆìŠµë‹ˆë‹¤.
    - CI ë‹¨ê³„ì—ì„œ Github Actionsë¥¼ í†µí•´ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•˜ëŠ”ë°, ë¹„ë°€ê°’ì„ ì½ì§€ ëª»í•´ í…ŒìŠ¤íŠ¸ê°€ ê¹¨ì§€ëŠ” í˜„ìƒì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤.
  - í•´ê²° ë°©ì•ˆ
    - Githubì— ë¹„ë°€ ê°’ë“¤ì„ ì €ì¥í•˜ê³ , Github Actions ë™ì‘ ê³¼ì •ì—ì„œ `echo` ë¥¼ í†µí•´ í™˜ê²½ë³€ìˆ˜ë¥¼ ì§‘ì–´ë„£ì–´ì£¼ëŠ” ë°©ì‹ìœ¼ë¡œ ë¬¸ì œë¥¼ í•´ê²°í–ˆìŠµë‹ˆë‹¤. 
</details>
